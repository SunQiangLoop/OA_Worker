# 财务管理系统 产品需求文档 (PRD)

**文档版本**: V1.0  
**创建日期**: 2026-01-25  
**产品名称**: 财务管理系统 (Financial Management System)  
**目标用户**: 物流企业财务人员、会计人员、出纳人员、财务主管

---

## 一、产品概述

### 1.1 产品定位

财务管理系统是一款面向物流企业的一体化财务管理平台，涵盖业务结算、应收应付、凭证管理、会计核算、财务报表等全流程财务管理功能。系统采用业财一体化设计，实现业务单据到会计凭证的自动化生成。

### 1.2 核心价值

- **业财一体化**: 运单结算、对账等业务单据自动生成会计凭证
- **智能会计引擎**: 可配置的会计规则引擎，自动完成记账
- **全流程覆盖**: 从业务发生到财务报表的完整闭环
- **合规性保障**: 符合企业会计准则，支持小企业和企业会计准则切换

### 1.3 技术架构

- **前端技术**: HTML5 + JavaScript (ES6) + CSS3
- **架构模式**: 单页应用 (SPA)，模块化设计
- **数据存储**: sessionStorage + localStorage (前端原型)
- **后端对接**: 预留 API 接口，支持与 FastAPI 后端集成

---

## 二、用户角色与权限

### 2.1 角色定义

| 角色 | 职责 | 核心功能权限 |
|------|------|-------------|
| **财务主管** | 财务全局管理、审批 | 所有模块的查看、审核、关账权限 |
| **会计** | 凭证录入、账务处理 | 凭证管理、科目管理、期末处理 |
| **出纳** | 资金收付、银行对账 | 收付款执行、资金账户、银行流水 |
| **结算员** | 业务结算、对账 | 运单结算、对账管理、应收应付 |
| **系统管理员** | 系统配置、权限管理 | 基础设置、权限分配、数据初始化 |

### 2.2 权限矩阵

权限采用功能模块级控制，通过 `Permission` 模块进行配置，支持按角色分配菜单访问权限和操作权限(查看/新增/修改/删除/审核)。

---

## 三、功能需求详述

### 3.1 核心仪表盘 (Dashboard)

**功能说明**: 系统首页，展示关键财务指标和快捷入口。

**关键指标卡片**:
- 本月预估营收
- 待付运费总额
- 当前资金池余额
- 本月待处理单据数

**功能导航**: 分四大中心
1. **财务管理中心**: 运单结算、应收管理、应付管理、发票管理、异动管理、对账管理
2. **出纳管理中心**: 资金账户、收款付款、付款核销、钱包管理、资金流水明细
3. **总账中心**: 会计基础、凭证管理、会计引擎、期末处理、会计报表、总账、管理报表
4. **系统配置**: 基础设置、收支方式配置、权限分配、操作日志

---

### 3.2 财务管理模块

#### 3.2.1 结算管理

##### A. 运单结算 (SettlementWaybill)

**业务场景**: 对已完成的运单进行结算确认，生成应付单据。

**数据字段**:
- 运单号、订单号、建单人、审核信息
- 支付状态、建单人身份、司机单号、司机单状态
- 创建时间、装货时间、卸货时间、完成时间
- 运费金额、支付税率、支付税金
- 司机信息、车牌、货物名称/包装件数
- 货物重量/体积、始发地、目的地
- 实际支付金额、支付时间、推送主体

**核心功能**:
- 批量导入运单数据
- 运单状态筛选(待结算/已结算)
- 结算确认操作
- 生成应付款单
- 触发会计引擎生成凭证

**交互流程**:
1. 系统自动从业务系统同步运单数据
2. 结算员筛选"已完成"状态运单
3. 确认运费金额、税金信息
4. 点击"确认结算"按钮
5. 系统生成应付款单并触发凭证生成

---

##### B. 干线批次结算 (SettlementTrunk)

**业务场景**: 对干线运输批次进行批量结算。

**核心字段**:
- 批次号、路线、车牌、司机
- 批次状态(待发车/运输中/已卸车)
- 装车时间、卸车时间
- 运单数量、总运费、税金
- 结算状态

**操作功能**:
- 批次创建、批次详情查看
- 批次运单明细
- 批次结算确认
- 生成批量付款申请

---

##### C. 短途批次结算 (SettlementShortHaul)

**功能说明**: 短途配送批次的结算处理，流程类似干线批次结算。

**特殊逻辑**: 支持"快捷结算"，自动创建应付款单。

---

#### 3.2.2 对账管理

##### A. 网点对账 (ReconSite)

**业务目标**: 与下游网点核对应收/应付金额。

**对账流程**:
1. 生成对账单(按网点、按期间)
2. 发送对账单给网点
3. 网点确认或提出异议
4. 差异处理
5. 对账确认

**数据管理**: 对账单号、网点名称、对账期间、应收金额、应付金额、差异金额、状态

---

##### B. 客户对账 (ReconCustomer)

**对账维度**: 按客户汇总应收款项。

**关键功能**:
- 客户对账单生成
- 对账单确认
- 生成应收款确认单

---

##### C. 承运商对账 (ReconCarrier) 

**对账内容**: 承运商运费核对。

**业务特点**: 需匹配运单明细，核对运费、税金。

---

##### D. 司机对账 (ReconDriver)

**对账逻辑**: 司机个人账户应付款核对。

---

##### E. 对账差异处理 (ReconDiffHandle)

**功能定位**: 处理对账过程中发现的差异。

**差异类型**:
- 金额差异、数量差异、科目差异
- 时间性差异

**处理方式**:
- 调整单据、补充凭证、协商解决

---

#### 3.2.3 应收管理 (AR)

##### A. 客户对账单列表 (ARCustomerStatement)

**功能**: 管理客户应收款对账单。

**字段**: 对账单号、客户名称、账期、应收金额、已收金额、未收金额、状态

**操作**: 查看明细、生成发票申请、发起收款

---

##### B. 预收款单 (ARPrecollection)

**场景**: 客户提前支付款项管理。

**核心字段**: 预收款单号、客户、金额、收款账户、收款时间

**财务处理**: 
- 借: 银行存款
- 贷: 预收账款

---

##### C. 客户收款核销 (ARCollectionVerify)

**核心业务**: 将客户实际付款与应收款单据进行核销。

**核销规则**:
- 支持一对一核销
- 支持一对多核销
- 支持部分核销

**核销后处理**: 更新应收账款余额，生成收款凭证

---

##### D. 客户账龄分析 (ARAgeAnalysis)

**分析维度**: 按账龄区间(30天内、31-60天、61-90天、90天以上)统计应收款。

**展示内容**:
- 客户名称、应收总额
- 各账龄段金额、占比
- 坏账风险提示

---

#### 3.2.4 应付管理 (AP)

##### A. 供应商付款申请 (APPaymentApply)

**申请流程**:
1. 结算员创建付款申请
2. 填写供应商、金额、付款事由
3. 上传附件(对账单、发票等)
4. 提交审批
5. 出纳执行付款

**字段**: 申请单号、供应商、付款金额、申请日期、审批状态、付款状态

---

##### B. 预付款单 (APPrepayment)

**场景**: 向供应商预付货款或运费。

**管理内容**: 预付款单号、供应商、金额、预付原因、核销状态

---

##### C. 付款核销 (APPaymentVerify)

**核销对象**: 将实际支付款项与应付款单据进行匹配核销。

**核销凭证**: 自动生成
- 借: 应付账款
- 贷: 银行存款

---

#### 3.2.5 资金与能源管理

##### A. 客户资金账户 (FundCustomerAcct)

**功能**: 管理客户的资金账户余额。

**账户类型**:
- 预存款账户
- 授信账户

**操作**: 充值、扣款、冻结、解冻

---

##### B. 能源账户管理 (FundEnergyAcct)

**业务背景**: 管理加油卡、ETC 卡等能源账户。

**管理内容**: 账户余额、充值记录、消费记录

---

##### C. 司机/网点钱包 (FundWallet)

**功能定位**: 司机和网点的虚拟钱包管理。

**钱包操作**: 入账、提现、冻结

---

##### D. 收款与付款执行 (FundExecution)

**功能说明**: 出纳执行实际收付款操作。

**收款流程**:
1. 选择收款方式(银行转账/现金/支付宝等)
2. 录入收款金额、收款账户
3. 上传银行回单
4. 确认收款
5. 生成收款凭证

**付款流程**: 类似收款，额外需要审批流程

---

##### E. 清分与分账规则 (FundClearingRule)

**业务场景**: 设置资金清分规则，如平台手续费、分成比例等。

**规则配置**: 按业务类型、客户等级设置不同的清分规则

---

#### 3.2.6 异动管理 (AbnormalManagement)

**功能定位**: 处理异常业务单据。

**异动类型**:
- 运费调整
- 退款
- 补款
- 其他异常

**处理流程**: 异动申请 → 审批 → 财务调整 → 凭证调整

---

#### 3.2.7 风控与日志

##### A. 敏感操作日志 (RiskSensitiveLog)

**记录内容**:
- 操作时间、操作人、IP地址
- 操作模块、操作动作
- 操作详情、风险级别(低/中/高/高危)

**敏感操作定义**:
- 凭证红冲、凭证删除
- 期末结账、反结账
- 权限变更、科目变更
- 大额资金操作

---

##### B. 数据变更明细 (RiskDataChange)

**追溯功能**: 记录关键数据的变更历史。

**变更记录**: 对象类型、对象ID、字段名、变更前值、变更后值、变更时间、变更人

---

### 3.3 会计核算模块

#### 3.3.1 会计基础

##### A. 会计科目 (AcctSubject)

**科目管理**:
- 支持小企业会计准则和企业会计准则
- 科目编码可配置级次(默认3级: 4-2-2)
- 科目类型: 资产、负债、权益、成本、损益

**科目字段**:
- 科目编码、科目名称
- 科目类型、余额方向
- 辅助核算(客户、供应商、项目、部门等)
- 启用状态、备注

**预置科目**: 系统根据会计准则自动初始化常用科目

---

##### B. 会计账套 (AcctSet)

**账套管理**: 支持多账套，按公司、部门设置独立账套。

---

##### C. 会计期间 (AcctPeriod)

**期间设置**: 按年月设置会计期间，如 2025-01、2025-02

**期间状态**: 未开始、进行中、已关闭

---

##### D. 辅助核算项 (AcctAuxiliary)

**辅助核算类型**:
- 客户辅助核算
- 供应商辅助核算
- 部门辅助核算
- 项目辅助核算
- 员工辅助核算
- 车辆/设备辅助核算

**数据维护**: 支持新增、编辑、停用辅助核算项

---

#### 3.3.2 凭证管理

##### A. 凭证录入 (VoucherEntryReview)

**凭证录入界面**:
- 凭证字(记、收、付、转)
- 凭证日期、凭证号
- 分录明细(摘要、科目、借方、贷方、辅助核算)

**录入规则**:
- 借贷必须平衡
- 支持摘要模板快速输入
- 科目智能提示

**凭证操作**:
- 保存、暂存、提交审核
- 打印凭证

---

##### B. 凭证审核中心 (FinanceVoucherAudit)

**审核功能**:
- 待审核凭证列表
- 凭证审核(通过/驳回)
- 批量审核

**审核规则**:
- 检查借贷平衡
- 检查科目合法性
- 检查金额合理性

---

##### C. 凭证查询打印 (VoucherQueryPrint)

**查询条件**:
- 凭证号、日期范围
- 凭证状态(待审核/已审核/已记账/已冲销)
- 科目、摘要

**批量操作**:
- 批量打印凭证
- 批量导出凭证

---

##### D. 凭证详情 (VoucherDetail)

**详情展示**:
- 凭证头信息(凭证号、日期、制单人)
- 分录明细表
- 附件清单
- 审批流程

**操作按钮**:
- 查看、修改(待审核状态)
- 红冲、作废(已记账状态)

---

#### 3.3.3 会计引擎

##### A. 会计规则配置 (SettlementEngineConfig)

**引擎功能**: 配置业务单据到会计凭证的自动转换规则。

**规则示例**:
- 运单结算 → 生成凭证
  - 借: 主营业务成本
  - 贷: 应付账款
- 客户收款 → 生成凭证
  - 借: 银行存款
  - 贷: 应收账款

**配置字段**:
- 触发条件(单据类型、状态)
- 凭证模板(科目、借贷方向、取值规则)
- 税率计算规则

---

#### 3.3.4 期末处理

##### A. 结转损益 (PeriodEndProfit)

**业务目标**: 将损益类科目余额结转到"本年利润"。

**结转逻辑**:
1. 计算所有损益类科目余额
2. 收入类科目借方结转(清零)
3. 费用成本类科目贷方结转(清零)
4. 差额计入"本年利润"

**生成凭证**:
- 借: 主营业务收入(收入金额)
- 贷: 本年利润
- 借: 本年利润
- 贷: 主营业务成本、管理费用等(费用金额)

**状态检查**: 结账锁定期间不允许结转

---

##### B. 月末结账/锁定 (PeriodEndClose)

**结账前检查清单**:
- 所有凭证已审核
- 所有业务单据已入账
- 已完成固定资产折旧计算
- 已完成损益类科目结转
- 试算平衡检查

**结账操作**:
1. 执行检查清单
2. 所有检查通过后,允许结账
3. 锁定当前会计期间
4. 自动切换到下一期间

**结账后限制**:
- 不能修改/删除已锁定期间的凭证
- 不能录入已锁定期间的单据

---

##### C. 反结账 (Re-Open)

**使用场景**: 发现已结账期间数据有误,需要重新打开。

**操作流程**:
1. 财务主管申请反结账
2. 输入反结账原因
3. 系统记录高危操作日志
4. 解除期间锁定
5. 允许修改数据

**风险提示**: 反结账属于高危操作,需要严格审批和日志记录

---

### 3.4 数据报表模块

#### 3.4.1 财务报表

##### A. 科目余额表 (AcctSubjectBalance)

**报表内容**:
- 科目编码、科目名称
- 期初余额(借/贷)
- 本期发生额(借/贷)
- 期末余额(借/贷)

**查询条件**: 会计期间、科目级次、科目类型

---

##### B. 明细账 (AcctSubjectDetail)

**明细内容**: 按科目展示每笔凭证的分录明细。

**字段**: 日期、凭证号、摘要、借方、贷方、余额、对方科目

---

##### C. 试算平衡表 (ReportTrialBalance)

**检查内容**:
- 借方发生额合计 = 贷方发生额合计
- 借方余额合计 = 贷方余额合计
- 资产类余额 = 负债类余额 + 所有者权益类余额

**不平衡提示**: 如有差额,给出明细追踪线索

---

##### D. 资产负债表 (ReportBalanceSheet)

**报表结构**:
- 资产: 流动资产、非流动资产
- 负债: 流动负债、非流动负债
- 所有者权益: 实收资本、资本公积、未分配利润

**平衡公式**: 资产 = 负债 + 所有者权益

---

##### E. 利润损益表 (ReportIncomeStatement)

**报表内容**:
- 营业收入
- 营业成本
- 营业利润 = 营业收入 - 营业成本 - 期间费用
- 利润总额
- 净利润

---

##### F. 现金流量表 (ReportCashFlow)

**三大活动**:
- 经营活动现金流
- 投资活动现金流
- 筹资活动现金流

---

##### G. 其他报表 (ReportOtherStatutory)

**扩展报表**: 所有者权益变动表等

---

#### 3.4.2 管理报表

##### A. 单车线路盈亏分析 (ReportVehicleProfit)

**分析维度**: 按车辆、按线路统计收入成本。

**计算逻辑**: 收入 - 成本 - 费用 = 利润

---

##### B. 客户毛利分析 (ReportCustomerProfit)

**分析内容**: 按客户统计营收、成本、毛利率。

---

##### C. 应收应付账龄分析 (ReportARAPAge)

**分析维度**: 应收款账龄、应付款账龄

---

### 3.5 系统配置模块

#### 3.5.1 基础设置 (AccountingStandardSetting)

**会计准则选择**:
- 小企业会计准则
- 企业会计准则

**科目编码设置**:
- 科目级次(2-5级可选)
- 各级编码长度

**凭证摘要模板**:
- 摘要编码、摘要内容、助记码、类别

**数据初始化**: 首次进入系统必须完成基础设置

---

#### 3.5.2 期初余额录入 (FinanceOpeningBalance)

**录入内容**: 各科目的期初余额(借方/贷方)。

**平衡验证**: 借方合计 = 贷方合计

---

#### 3.5.3 权限管理 (Permission)

**权限配置**:
- 角色管理
- 菜单权限分配
- 操作权限分配(增删改查审)

---

#### 3.5.4 收支方式配置 (PaymentMethodConfig)

**收支方式**:
- 银行转账、现金、支付宝、微信
- 承兑汇票、信用卡等

**关联科目**: 每种收支方式关联对应的会计科目

---

## 四、数据模型

### 4.1 核心实体

#### 运单 (Waybill)
```javascript
{
  orderNo: "YD2601131639000125",      // 运单号
  creator: "余风华/13337717906",     // 建单人
  auditInfo: "已到账",                // 审核信息
  payStatus: "已到账",                // 支付状态
  driverOrderNo: "SJ2601131639000227", // 司机单号
  freightAmount: 5300,                 // 运费金额
  taxRate: "6%",                       // 税率
  taxAmount: 338.3,                    // 税额
  driver: "房毛斗/17280055706",       // 司机
  plate: "豫NN2450",                   // 车牌
  origin: "徐州徐工...",              // 始发地
  destination: "赤岸镇",               // 目的地
  createdAt: "2026-01-13 16:39:23",   // 创建时间
  loadAt: "2026-01-13 18:00:25",      // 装货时间
  unloadAt: "2026-01-15 10:38:37",    // 卸货时间
  finishAt: "2026-01-15 14:26:33"     // 完成时间
}
```

#### 会计凭证 (Voucher)
```javascript
{
  id: "记20251001",                    // 凭证号
  date: "2025-10-01",                  // 凭证日期
  amount: "1000.00",                   // 凭证金额
  user: "张会计",                      // 制单人
  status: "已审核",                    // 状态
  isRed: false,                        // 是否红字
  lines: [                             // 凭证分录
    {
      summary: "收到股东注资",         // 摘要
      account: "1002 银行存款",        // 科目
      debit: "1000000.00",             // 借方
      credit: ""                       // 贷方
    },
    {
      summary: "收到股东注资",
      account: "4001 实收资本",
      debit: "",
      credit: "1000000.00"
    }
  ]
}
```

#### 会计科目 (Subject)
```javascript
{
  code: "1002",                        // 科目编码
  name: "银行存款",                    // 科目名称
  type: "资产",                        // 科目类型
  direction: "借",                     // 余额方向
  aux: "银行账户",                     // 辅助核算
  status: "启用",                      // 状态
  remark: "银行往来资金"               // 备注
}
```

### 4.2 数据存储策略

- **sessionStorage**: 当前会话数据(凭证、单据等业务数据)
- **localStorage**: 基础配置数据(科目、摘要模板、会计准则设置)

### 4.3 数据接口规范

#### 运单结算接口
```
POST /api/waybills/settle
Request: {
  waybillIds: ["YD001", "YD002"],
  settleDate: "2025-11-30"
}
Response: {
  success: true,
  message: "结算成功",
  apPaymentId: "AP20251130001"
}
```

#### 凭证保存接口
```
POST /api/vouchers
Request: {
  date: "2025-11-30",
  lines: [
    {summary: "...", account: "1002", debit: 1000, credit: 0},
    {summary: "...", account: "4001", debit: 0, credit: 1000}
  ]
}
Response: {
  success: true,
  voucherId: "记20251001"
}
```

---

## 五、UI/UX 设计要点

### 5.1 整体布局

- **顶部导航栏**: 系统名称、用户信息、退出
- **左侧边栏**: 分组菜单(核心仪表盘、财务管理、会计核算、数据报表、设置)
- **主内容区**: 动态加载模块内容
- **面包屑导航**: 显示当前位置

### 5.2 交互规范

#### 表格展示
- 支持排序、筛选、分页
- 行内操作按钮(查看、编辑、删除)
- 批量操作(Excel 导出、批量审核)

#### 表单录入
- 必填项标红星提示
- 实时校验提示
- 智能补全(科目、客户等)
- 摘要模板快速选择

#### 弹窗交互
- 详情查看弹窗
- 确认操作弹窗(删除、红冲等高危操作)
- 表单编辑弹窗

### 5.3 视觉风格

- **色彩**: 蓝色系主色调(专业、可信)
- **状态标识**: 
  - 绿色: 已完成、已审核
  - 橙色: 待处理、警告
  - 红色: 已拒绝、高危
  - 灰色: 已作废、已关闭
- **图标**: 统一使用 emoji 或 icon font

---

## 六、非功能需求

### 6.1 性能要求

- 页面加载时间 < 2秒
- 列表查询响应时间 < 1秒
- 报表生成时间 < 5秒(万级数据)

### 6.2 安全要求

- 操作日志完整记录
- 敏感操作二次确认
- 高危操作(反结账、凭证红冲)需审批
- 数据备份机制

### 6.3 可用性要求

- 支持主流浏览器(Chrome、Edge、Safari)
- 响应式布局,适配不同屏幕
- 菜单搜索功能
- 快捷键支持(如 Ctrl+S 保存凭证)

### 6.4 扩展性要求

- 模块化设计,便于新增功能模块
- 会计引擎规则可配置
- 支持多账套、多组织

---

## 七、开发优先级

### P0 (必须实现)
- 会计基础设置(科目、账套、期间)
- 凭证录入、审核、查询
- 科目余额表、试算平衡表
- 权限管理

### P1 (核心功能)
- 运单结算
- 应收应付管理
- 会计引擎
- 期末结账
- 资产负债表、利润表

### P2 (增强功能)
- 对账管理
- 发票管理
- 资金管理
- 固定资产管理
- 管理报表

---

## 八、验收标准

### 8.1 功能验收

- 所有 P0、P1 功能模块开发完成
- 核心业务流程跑通(运单→结算→凭证→报表)
- 会计引擎自动生成凭证准确率 100%
- 财务报表借贷平衡

### 8.2 质量验收

- 单元测试覆盖率 > 80%
- 无 P0/P1 级别 Bug
- 代码符合规范,通过 Code Review
- 性能指标达标

### 8.3 文档验收

- 用户操作手册
- 系统管理员手册
- API 接口文档
- 数据库设计文档

---

## 九、项目里程碑

| 里程碑 | 交付内容 | 时间 |
|--------|---------|------|
| M1: 基础框架 | 会计科目、凭证录入、科目余额表 | Week 1-2 |
| M2: 核心财务 | 运单结算、应收应付、会计引擎 | Week 3-4 |
| M3: 期末处理 | 结转损益、期末结账、财务报表 | Week 5-6 |
| M4: 系统完善 | 权限管理、日志审计、优化调优 | Week 7-8 |

---

## 十、附录

### 10.1 术语表

- **权责发生制**: 收入和费用按发生期间确认
- **借贷记账法**: 会计复式记账方法
- **辅助核算**: 对会计科目按客户、项目等维度细化核算
- **红字凭证**: 用负数冲销原凭证的特殊凭证
- **试算平衡**: 验证账簿借贷是否平衡

### 10.2 参考标准

- 《企业会计准则》
- 《小企业会计准则》
- 《会计基础工作规范》

---

**文档结束**
